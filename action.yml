name: Helm Release Branch Action

description: |-
  Automates the process of updating a Helm chart set of values-files to tag a
  new release (ie, updating the Image Tag), then merges that into a "release"
  branch automatically for you.

author: Matt Wise <matt@nextdoor.com>

branding:
  color: green
  icon: arrow-up-right

inputs:
  dry:
    description: Whether or not this action will run in a dry run or not.
    default: false
    required: false

  verbose:
    description: |-
      Should the script output all of the commands (set -x) while its running or not?
    default: false
    required: false

  commit_message:
    description: Commit message
    required: false
    default: Apply automatic changes

  branch:
    description: Git branch name, where changes should be pushed too. Required if Action is used on the `pull_request` event
    required: false
    default: ${{ github.head_ref }}

  dest_branch:
    description: Git branch name to auto-merge $branch into. If not set, then the automerge feature is disabled.
    required: false
    default: ''

  commit_options:
    description: Commit options (eg. --no-verify)
    required: false
    default: ''

  add_options:
    description: Add options (eg. -u)
    required: false
    default: ''

  status_options:
    description: Status options (eg. --untracked-files=no)
    required: false
    default: ''

  file_pattern:
    description: File pattern used for `git add`. For example `src/\*.js`
    required: false
    default: '.'

  repository:
    description: Local file path to the git repository. Defaults to the current directory (`.`)
    required: false
    default: '.'

  commit_user_name:
    description: Name used for the commit user
    required: false
    default: GitHub Actions

  commit_user_email:
    description: Email address used for the commit user
    required: false
    default: actions@github.com

  commit_author:
    description: Value used for the commit author. Defaults to the username of whoever triggered this workflow run.
    required: false
    default: ${{ github.actor }} <${{ github.actor }}@users.noreply.github.com>

  push_options:
    description: Push options (eg. --force)
    required: false
    default: ''

  skip_dirty_check:
    description: Skip the check if the git repository is dirty and always try to create a commit.
    required: false
    default: false

  skip_fetch:
    description: Skip the call to git-fetch.
    required: false
    default: false

  disable_globbing:
    description: Stop the shell from expanding filenames (https://www.gnu.org/software/bash/manual/html_node/Filename-Expansion.html)
    default: false

outputs:
  changes_detected:
    description: Value is "true", if the repository was dirty and file changes have been detected. Value is "false", if no changes have been detected.

runs:
  using: docker
  image: Dockerfile
